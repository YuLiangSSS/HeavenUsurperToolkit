<Page x:Class="HeavenUsurperToolkit.Page3"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:HeavenUsurperToolkit"
      mc:Ignorable="d" 
      d:DesignHeight="850" d:DesignWidth="800"
      Title="页面置换算法">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 间隔 -->
        <Rectangle Height="65" VerticalAlignment="Top"/>

        <!-- 控制面板 -->
        <Grid Grid.Row="2" Margin="20,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧控制区 -->
            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                <TextBlock Text="算法选择：" FontSize="18" Margin="0,0,0,5" Foreground="#FF8E6CDC" FontWeight="Bold"/>
                <ComboBox x:Name="AlgorithmSelector" SelectedIndex="0" Margin="0,0,0,10" Style="{StaticResource ModernComboBox}" Background="#FFF8E6FF">
                    <ComboBoxItem Content="先进先出(FIFO)"/>
                    <ComboBoxItem Content="最近最久未使用(LRU)"/>
                </ComboBox>

                <TextBlock Text="内存块数量：" FontSize="18" Margin="0,0,0,5" FontWeight="Bold" Foreground="#FF8E6CDC"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBox x:Name="MemoryBlocksInput" Width="100" Text="3" Style="{StaticResource ModernTextBox}"/>
                    <Button x:Name="SetMemoryButton" Content="设置" Width="92" Height="35" Margin="10,0,0,0"
                            Click="SetMemoryButton_Click" Style="{StaticResource ModernButton}"/>
                </StackPanel>

                <TextBlock Text="填写完整页面序列：" FontSize="18" Margin="0,0,0,5" FontWeight="Bold" Foreground="#FF8E6CDC"/>
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <TextBox x:Name="PageSequenceInput" Width="200" Text="" Style="{StaticResource ModernTextBox}"/>
                    <Button x:Name="GenerateSequenceButton" Content="随机生成" Width="120" Height="35" Margin="10,0,0,0"
                            Click="GenerateSequenceButton_Click" Style="{StaticResource ModernButton}"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <Button x:Name="StartSimulationButton" Content="开始模拟" Width="120" Height="40" 
                            Click="StartSimulationButton_Click" Style="{StaticResource ModernButton}"/>
                    <Button x:Name="ClearResultsButton" Content="清空结果" Width="120" Height="40" Margin="10,0,0,0"
                            Click="ClearResultsButton_Click" Style="{StaticResource ModernButton}"/>
                </StackPanel>
            </StackPanel>

            <!-- 右侧添加页面区 -->
            <Border Grid.Column="1" BorderBrush="#CCCCCC" BorderThickness="1" Padding="10" Margin="10,0,0,0" CornerRadius="5">
                <StackPanel>
                    <TextBlock Text="手动添加页面：" FontSize="18" Margin="0,0,0,10" Foreground="#FF8E6CDC" FontWeight="Bold"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="页面号：" VerticalAlignment="Center" Margin="0,0,5,0" FontSize="16" FontWeight="Bold" Foreground="#FF8E6CDC"/>
                        <TextBox x:Name="SinglePageInput" Width="100" Style="{StaticResource ModernTextBox}"/>
                        <Button x:Name="AddPageButton" Content="添加" Width="80" Height="35" Margin="10,0,0,0"
                                Click="AddPageButton_Click" Style="{StaticResource ModernButton}"/>
                    </StackPanel>

                    <TextBlock Text="当前页面序列：" FontSize="16" Margin="0,10,0,5" Foreground="#FF8E6CDC" FontWeight="Bold"/>
                    <TextBlock x:Name="CurrentSequenceDisplay" Text="" FontSize="14" Margin="0,0,0,10" 
                               TextWrapping="Wrap" Background="#FFF8E6FF" Padding="5"/>

                    <TextBlock Text="缺页率统计：" FontSize="16" Margin="0,10,0,5" Foreground="#FF8E6CDC" FontWeight="Bold"/>
                    <TextBlock x:Name="PageFaultRateDisplay" Text="缺页次数: 0, 总访问次数: 0, 缺页率: 0.00%" 
                               FontSize="14" Margin="0,0,0,10" Background="#FFF8E6FF" Padding="5"/>
                </StackPanel>
            </Border>
        </Grid>

        <!-- 结果显示区域 -->
        <Grid Grid.Row="3" Margin="20,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左侧模拟过程 -->
            <Border Grid.Column="0" BorderBrush="#CCCCCC" BorderThickness="1" CornerRadius="5" Grid.ColumnSpan="2">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="模拟过程" FontSize="18" FontWeight="Bold" Margin="10,5" Foreground="#FF8E6CDC"/>
                    <ListView x:Name="SimulationProcessListView" Margin="10" Style="{StaticResource ModernListView}">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="步骤" DisplayMemberBinding="{Binding Step}" Width="50"/>
                                <GridViewColumn Header="访问页面" DisplayMemberBinding="{Binding PageAccessed}" Width="80"/>
                                <GridViewColumn Header="内存状态" DisplayMemberBinding="{Binding MemoryState}" Width="120"/>
                                <GridViewColumn Header="是否缺页" DisplayMemberBinding="{Binding IsPageFault}" Width="80"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </DockPanel>
            </Border>

            <!-- 右侧内存状态可视化 -->
            <Border Grid.Column="1" BorderBrush="#CCCCCC" BorderThickness="1" Margin="10,0,0,0" CornerRadius="5" Visibility="Hidden">
                <DockPanel Visibility="Hidden">
                    <TextBlock DockPanel.Dock="Top" Text="当前内存状态" FontSize="18" FontWeight="Bold" Margin="10,5" Foreground="#FF8E6CDC"/>
                    <StackPanel x:Name="MemoryVisualizationPanel" Margin="10" Orientation="Vertical">
                        <!-- 内存块可视化将在代码中动态生成 -->
                    </StackPanel>
                </DockPanel>
            </Border>
        </Grid>

        <Button Grid.Row="4" x:Name="BackButton" Content="←" Height="45" Width="45" Margin="10,0,0,10" 
            HorizontalAlignment="Left" VerticalAlignment="Bottom" Style="{StaticResource ModernButton}" 
            FontSize="30" Click="BackButton_Click" />
    </Grid>
</Page>